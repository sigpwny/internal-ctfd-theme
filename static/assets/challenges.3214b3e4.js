import{m as n,C as a,h,T as c,d as u,M as g,a as p}from"./index.7e48942e.js";function i(e){let t=new DOMParser().parseFromString(e,"text/html");return t.querySelectorAll('a[href*="://"]').forEach(o=>{o.setAttribute("target","_blank")}),t.documentElement.outerHTML}window.Alpine=n;n.store("challenge",{data:{view:""}});n.data("Hint",()=>({id:null,html:null,async showHint(e){if(e.target.open){let t=(await a.pages.challenge.loadHint(this.id)).data;if(t.content)this.html=i(t.html);else if(await a.pages.challenge.displayUnlock(this.id)){let o=await a.pages.challenge.loadUnlock(this.id);if(o.success){let d=(await a.pages.challenge.loadHint(this.id)).data;this.html=i(d.html)}else e.target.open=!1,a._functions.challenge.displayUnlockError(o)}else e.target.open=!1}}}));n.data("Challenge",()=>({id:null,next_id:null,submission:"",tab:null,solves:[],response:null,share_url:null,max_attempts:0,attempts:0,async init(){h()},getStyles(){let e={"modal-dialog":!0};try{switch(a.config.themeSettings.challenge_window_size){case"sm":e["modal-sm"]=!0;break;case"lg":e["modal-lg"]=!0;break;case"xl":e["modal-xl"]=!0;break;default:break}}catch(s){console.log("Error processing challenge_window_size"),console.log(s)}return e},async init(){h()},async showChallenge(){new c(this.$el).show()},async showSolves(){this.solves=await a.pages.challenge.loadSolves(this.id),this.solves.forEach(e=>(e.date=u(e.date).format("MMMM Do, h:mm:ss A"),e)),new c(this.$el).show()},getNextId(){return n.store("challenge").data.next_id},async nextChallenge(){let e=g.getOrCreateInstance("[x-ref='challengeWindow']");e._element.addEventListener("hidden.bs.modal",s=>{n.nextTick(()=>{this.$dispatch("load-challenge",this.getNextId())})},{once:!0}),e.hide()},async getShareUrl(){let e={type:"solve",challenge_id:this.id};const l=(await(await a.fetch("/api/v1/shares",{method:"POST",body:JSON.stringify(e)})).json()).data.url;this.share_url=l},copyShareUrl(){navigator.clipboard.writeText(this.share_url);let e=p.getOrCreateInstance(this.$el);e.enable(),e.show(),setTimeout(()=>{e.hide(),e.disable()},2e3)},async submitChallenge(){this.response=await a.pages.challenge.submitChallenge(this.id,this.submission),await this.renderSubmissionResponse()},async renderSubmissionResponse(){this.response.data.status==="correct"&&(this.submission=""),this.max_attempts>0&&this.response.data.status!="already_solved"&&(this.attempts+=1),this.$dispatch("load-challenges")}}));n.data("ChallengeBoard",()=>({loaded:!1,challenges:[],challenge:null,async init(){if(this.challenges=await a.pages.challenges.getChallenges(),this.loaded=!0,window.location.hash){let e=decodeURIComponent(window.location.hash.substring(1).split("/").pop()),s=e.lastIndexOf("-");if(s>=0){let l=[e.slice(0,s),e.slice(s+1)][1];await this.loadChallenge(l)}}},getCategories(){const e=[];this.challenges.forEach(s=>{const{category:t}=s;e.includes(t)||e.push(t)});try{const s=a.config.themeSettings.challenge_category_order,t=window.init.topCategory;if(s){const l=new Function(`return (${s})`);e.sort(l()),e.sort((o,r)=>o===t?-1:r===t?1:0)}}catch(s){console.log("Error running challenge_category_order function"),console.log(s)}return e},getTabs(){const e=this.getCategories();let s=[{name:"All",categories:e}];try{const t=a.config.themeSettings.category_tabs;t&&(s=new Function(`return (${t})`)()(e))}catch(t){console.log("Error running category_tabs function"),console.log(t)}return s},getChallenges(e){let s=this.challenges;e!==null&&(s=this.challenges.filter(t=>t.category===e));try{const t=a.config.themeSettings.challenge_order;if(t){const l=new Function(`return (${t})`);s.sort(l())}}catch(t){console.log("Error running challenge_order function"),console.log(t)}return s},async loadChallenges(){this.challenges=await a.pages.challenges.getChallenges()},async loadChallenge(e,s){console.log(e,s),await a.pages.challenge.displayChallenge(e,t=>{t.data.view=i(t.data.view),n.store("challenge").data=t.data,n.nextTick(()=>{let l=g.getOrCreateInstance("[x-ref='challengeWindow']");l._element.addEventListener("hidden.bs.modal",o=>{history.replaceState(null,null,`#${window.location.hash.substring(1).split("/")[0]}`)},{once:!0}),l.show(),s!==void 0&&history.replaceState(null,null,`#${s.name}/${t.data.name}-${e}`)})})}}));n.start();
